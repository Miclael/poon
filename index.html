<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>GitHub API å¤šåŠŸèƒ½å·¥å…·</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    input, textarea, button, select { width: 100%; margin: 10px 0; padding: 10px; font-size: 16px; }
    button { cursor: pointer; }
    pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h2>ğŸ› ï¸ GitHub å¤šåŠŸèƒ½å·¥å…·</h2>

  <label>API ç¶²åŸŸï¼ˆé è¨­ https://api.github.comï¼‰</label>
  <input type="text" id="apiDomain" placeholder="ä¾‹å¦‚ï¼šhttps://api.github.com" value="https://api.github.com">

  <label>GitHub Token</label>
  <input type="password" id="token" placeholder="è¼¸å…¥ä½ çš„ GitHub Token">

  <label>å„²å­˜åº«åç¨±ï¼ˆä½¿ç”¨è€…/å„²å­˜åº«ï¼‰</label>
  <input type="text" id="repo" placeholder="ä¾‹å¦‚ï¼šmiclael/test-repo">

  <label>æª”æ¡ˆè·¯å¾‘ï¼ˆå«å‰¯æª”åï¼‰</label>
  <input type="text" id="filename" placeholder="ä¾‹å¦‚ï¼štest.txt æˆ– folder/test.txt">

  <label>æª”æ¡ˆå…§å®¹</label>
  <textarea id="content" rows="10" placeholder="åœ¨æ­¤è¼¸å…¥æˆ–ç·¨è¼¯æª”æ¡ˆå…§å®¹..."></textarea>

  <button onclick="getFile()">ğŸ“„ è®€å–æª”æ¡ˆ</button>
  <button onclick="uploadFile()">ğŸ“¤ ä¸Šå‚³ / æ›´æ–°æª”æ¡ˆ</button>
  <button onclick="deleteFile()">ğŸ—‘ï¸ åˆªé™¤æª”æ¡ˆ</button>
  <button onclick="listFiles()">ğŸ“ é¡¯ç¤ºæª”æ¡ˆæ¸…å–®</button>

  <pre id="result">ğŸ›ˆ æ“ä½œå›æ‡‰å°‡é¡¯ç¤ºåœ¨æ­¤</pre>

  <script>
    let fileSha = null;

    function getBaseUrl(path) {
      const api = document.getElementById("apiDomain").value.trim().replace(/\/$/, "");
      const repo = document.getElementById("repo").value.trim();
      return `${api}/repos/${repo}/${path}`;
    }

    async function getFile() {
      const token = getToken();
      const filename = document.getElementById("filename").value.trim();
      const result = document.getElementById("result");
      if (!filename) return result.textContent = "â— è«‹è¼¸å…¥æª”æ¡ˆåç¨±";

      const url = getBaseUrl(`contents/${filename}`);
      const res = await fetch(url, { headers: { Authorization: `Bearer ${token}` } });
      const data = await res.json();

      if (res.ok) {
        const decoded = decodeURIComponent(escape(atob(data.content)));
        document.getElementById("content").value = decoded;
        fileSha = data.sha;
        result.textContent = `âœ… æª”æ¡ˆè®€å–æˆåŠŸï¼ŒSHA: ${fileSha}`;
      } else {
        fileSha = null;
        result.textContent = `âš ï¸ éŒ¯èª¤ï¼š${data.message}`;
      }
    }

    async function uploadFile() {
      const token = getToken();
      const filename = document.getElementById("filename").value.trim();
      const content = document.getElementById("content").value;
      const result = document.getElementById("result");
      if (!filename || !content) return result.textContent = "â— æª”åèˆ‡å…§å®¹ä¸å¾—ç‚ºç©º";

      const url = getBaseUrl(`contents/${filename}`);
      const body = {
        message: `Upload or update ${filename}`,
        content: btoa(unescape(encodeURIComponent(content)))
      };
      if (fileSha) body.sha = fileSha;

      const res = await fetch(url, {
        method: "PUT",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Accept": "application/vnd.github+json"
        },
        body: JSON.stringify(body)
      });
      const data = await res.json();

      if (res.ok) {
        fileSha = data.content.sha;
        result.textContent = `âœ… ä¸Šå‚³æˆåŠŸï¼\nç¶²å€ï¼š${data.content.html_url}`;
      } else {
        result.textContent = `âŒ éŒ¯èª¤ï¼š\n${JSON.stringify(data, null, 2)}`;
      }
    }

    async function deleteFile() {
      const token = getToken();
      const filename = document.getElementById("filename").value.trim();
      const result = document.getElementById("result");
      if (!filename || !fileSha) return result.textContent = "â— è«‹å…ˆè®€å–æª”æ¡ˆä»¥å–å¾— SHA";

      const url = getBaseUrl(`contents/${filename}`);
      const res = await fetch(url, {
        method: "DELETE",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Accept": "application/vnd.github+json"
        },
        body: JSON.stringify({
          message: `Delete ${filename}`,
          sha: fileSha
        })
      });
      const data = await res.json();

      if (res.ok) {
        fileSha = null;
        document.getElementById("content").value = "";
        result.textContent = `ğŸ—‘ï¸ å·²åˆªé™¤æª”æ¡ˆ ${filename}`;
      } else {
        result.textContent = `âŒ éŒ¯èª¤ï¼š\n${JSON.stringify(data, null, 2)}`;
      }
    }

    async function listFiles() {
      const token = getToken();
      const result = document.getElementById("result");

      const url = getBaseUrl("contents");
      const res = await fetch(url, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();

      if (res.ok) {
        result.textContent = `ğŸ“ å„²å­˜åº«æª”æ¡ˆæ¸…å–®ï¼š\n\n` + data.map(f => `ğŸ“„ ${f.name}`).join("\n");
      } else {
        result.textContent = `âŒ éŒ¯èª¤ï¼š\n${JSON.stringify(data, null, 2)}`;
      }
    }

    function getToken() {
      return document.getElementById("token").value.trim();
    }
  </script>
</body>
</html>
